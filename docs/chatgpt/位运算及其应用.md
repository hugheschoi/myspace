# 位运算及其应用
## 什么是位运算，怎么用位运算解题

位运算是一种计算机中常用的操作，它对数字的二进制位进行操作。常见的位运算符包括：

与运算(&)：对两个二进制数的每一位进行与运算，只有在两个位均为 1 时，结果才为 1。

或运算(|)：对两个二进制数的每一位进行或运算，只有在两个位均为 0 时，结果才为 0。

异或运算(^)：对两个二进制数的每一位进行异或运算，只有在两个位不相同时，结果才为 1。

取反运算(~)：将二进制数的每一位取反，即 0 变为 1，1 变为 0。

左移运算(<<)：将二进制数向左移动指定的位数，高位补 0。

右移运算(>>)：将二进制数向右移动指定的位数，低位补 0 或 1，取决于操作系统的实现。

位运算常常被用于位掩码，即使用二进制数的每一位来表示一个开关的状态。例如，可以使用一个 8 位的二进制数来表示 8 个开关的状态。如果第 3 个开关被打开，那么二进制数的第 3 位就是 1，否则就是 0。这样可以使用位运算来快速地进行开关状态的操作。

**在解题时，位运算可以用于以下情况：**
快速计算一个数的二进制表示中有多少个 1。

- 交换两个变量的值。
- 判断一个数是否是 2 的幂。
- 将一个数的二进制表示中的所有 0 变为 1，或者将所有 1 变为 0。
- 对二进制数进行快速幂运算。
- 判断一个数的奇偶性。
- 从一个二进制数中提取出某些特定的位。
- 实现布隆过滤器等数据结构。
- 在实际应用中，位运算常常能够提高程序的效率，因此学习位运算对于提高编程能力非常有帮助。

## 能用 js 举些例子吗

当然可以。以下是一些使用 JavaScript 中的位运算符的示例：
快速计算一个数的二进制表示中有多少个 1。

```js
function countOnes(n) {
  let count = 0;
  while (n !== 0) {
    count++;
    n &= n - 1;
  }
  return count;
}
console.log(countOnes(15)); // 输出 4
```

交换两个变量的值。

```js
let a = 5;
let b = 10;
a ^= b;
b ^= a;
a ^= b;
console.log(a, b); // 输出 10, 5
```

判断一个数是否是 2 的幂。

```js
function isPowerOfTwo(n) {
  return n !== 0 && (n & (n - 1)) === 0;
}
console.log(isPowerOfTwo(16)); // 输出 true
console.log(isPowerOfTwo(15)); // 输出 false
```

将一个数的二进制表示中的所有 0 变为 1，或者将所有 1 变为 0。

```js
let n = 123;
let inverted = ~n;
console.log(inverted); // 输出 -124
```

对二进制数进行快速幂运算。

```js
function pow(base, exponent) {
  let result = 1;
  while (exponent > 0) {
    if (exponent & 1) {
      result *= base;
    }
    base *= base;
    exponent >>= 1;
  }
  return result;
}
console.log(pow(2, 10)); // 输出 1024
```

判断一个数的奇偶性。

```js
function isEven(n) {
  return (n & 1) === 0;
}
console.log(isEven(10)); // 输出 true
console.log(isEven(5)); // 输出 false
```

从一个二进制数中提取出某些特定的位。

```js
let n = 0b11010110;
let mask = 0b00001111;
let result = n & mask;
console.log(result); // 输出 0b00000110 = 6
```

这些例子只是位运算的冰山一角。在实际编程中，位运算可以用于解决许多问题，从算法到数据结构都有涉及。

## 还有吗

当然，以下是一些其他的位运算示例：

将一个数的二进制表示中的最后一位 1 变为 0。

```js
function unsetLastOne(n) {
  return n & (n - 1);
}
console.log(unsetLastOne(0b11010111)); // 输出 0b11010110 = 214
```

判断一个数的二进制表示中从最高位开始连续的 1 的个数。

```js
function countLeadingOnes(n) {
  let count = 0;
  while (n !== 0) {
    count++;
    n >>= 1;
  }
  return count;
}
console.log(countLeadingOnes(0b1110000111101111)); // 输出 3
```

将一个数的二进制表示中的最后 n 位设为 0。

```js
function unsetLastN(n, bits) {
  return n & (~0 << bits);
}
console.log(unsetLastN(0b10111011, 3)); // 输出 0b10111000 = 184
```

将一个数的二进制表示中的第 n 位设为 1。

```js
function setBit(n, bit) {
  return n | (1 << bit);
}
console.log(setBit(0b10111011, 4)); // 输出 0b10111111 = 191
```

将一个数的二进制表示中的第 n 位设为 0。

```js
function unsetBit(n, bit) {
  return n & ~(1 << bit);
}
console.log(unsetBit(0b10111011, 3)); // 输出 0b10110011 = 179
```

这些示例涵盖了位运算的许多应用，但是只是其中的一部分。在实际编程中，位运算经常被用于处理位级别的操作，例如图形处理、编码和解码等。

## 如何通过位运算去将体积巨大的 json 文件进行编码压缩

位运算可以用于对 JSON 数据进行编码压缩，以减少数据的传输和存储成本。一种常见的技术是使用一种称为 varint（variable-length integer）的编码方式，它使用可变长度的字节表示整数，以便更高效地编码小数值。以下是一个基于 JavaScript 的示例，它使用 varint 编码对 JSON 数据进行压缩：

```js
function encodeVarint(n) {
  let bytes = [];
  while (n > 127) {
    bytes.push((n & 127) | 128);
    n >>= 7;
  }
  bytes.push(n);
  return bytes;
}
function encodeJson(obj) {
  let json = JSON.stringify(obj);
  let bytes = [];
  for (let i = 0; i < json.length; i++) {
    bytes.push(json.charCodeAt(i));
  }
  let varint = encodeVarint(bytes.length);
  let result = new Uint8Array(varint.length + bytes.length);
  result.set(varint, 0);
  result.set(bytes, varint.length);
  return result;
}
function decodeVarint(bytes, offset) {
  let result = 0;
  let shift = 0;
  while (true) {
    let b = bytes[offset];
    result |= (b & 127) << shift;
    offset++;
    if (b < 128) {
      break;
    }
    shift += 7;
  }
  return [result, offset];
}
function decodeJson(bytes) {
  let [length, offset] = decodeVarint(bytes, 0);
  let json = "";
  for (let i = offset; i < offset + length; i++) {
    json += String.fromCharCode(bytes[i]);
  }
  return JSON.parse(json);
}
```

上述代码包含了两个主要函数 encodeJson 和 decodeJson。encodeJson 函数接受一个 JSON 对象作为参数，并返回一个 Uint8Array 类型的数组，其中包含了对 JSON 对象进行 varint 编码后的结果。decodeJson 函数接受一个 Uint8Array 类型的数组作为参数，并返回对应的 JSON 对象。这两个函数使用了一些辅助函数来实现 varint 编码和解码。

要解压缩 JSON 数据，可以使用以下代码：

```js
let decoded = decodeJson(encoded);
console.log(decoded);
```

这将返回解码后的 JSON 对象。

通过使用 varint 编码和位运算，我们可以将体积巨大的 JSON 文件进行编码压缩，以便更高效地传输和存储。

## 那么要怎么解码呢？

解码压缩后的数据可以使用上述代码中的 decodeJson 函数。该函数接受一个 Uint8Array 类型的数组作为参数，并返回对应的 JSON 对象。具体操作步骤如下：

将压缩后的数据转换为 Uint8Array 类型的数组，假设它被命名为 compressedData。

调用 decodeJson 函数并传入 compressedData 数组作为参数，得到解码后的 JSON 对象，假设它被命名为 decodedData。

```js
let decodedData = decodeJson(compressedData);
```

解码函数中的核心逻辑是根据 varint 编码的长度读取压缩后的 JSON 数据，并将其解码为字符串，最后再将字符串解析为 JSON 对象。在上述代码中，我们通过调用 decodeJson 函数将压缩后的数据解码为 JSON 对象。

需要注意的是，压缩后的数据只适用于传输和存储，并不适用于直接查看或修改。如果需要查看或修改 JSON 数据，需要先将其解码为常规的 JSON 对象，然后进行操作。


## 位运算还有其他应用吗

是的，位运算还有很多其他的应用。以下是一些常见的位运算应用：

位图：位图是一种数据结构，它使用二进制位来表示图像或其他数据。位运算可以用于对位图进行操作和处理，例如计算位图中某一区域的像素总数、查找位图中的特定颜色等。

加密和哈希函数：位运算可以用于实现加密和哈希函数。例如，一些加密算法和哈希函数使用位运算来处理二进制数据，以便更高效地加密和哈希。

掩码和位掩码：位运算可以用于创建掩码和位掩码。掩码是一种与特定位模式匹配的位序列，而位掩码是一种用于对特定位进行掩盖或屏蔽的位序列。

数据压缩：位运算可以用于数据压缩，例如对文本、音频、视频等数据进行压缩，以减少数据的传输和存储成本。在数据压缩中，位运算可以用于实现 Huffman 编码、Lempel-Ziv 编码等算法。

位计数：位运算可以用于计算二进制数中的位数或特定位的数量。例如，可以使用位运算计算一个数中有多少个位是 1，或者找到一个数中最高位的位置。

这只是位运算的一些常见应用，还有很多其他的应用。由于位运算处理的是二进制数据，因此它通常比其他类型的操作更高效，可以在许多不同的领域中得到广泛的应用。

